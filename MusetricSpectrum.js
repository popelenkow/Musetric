(()=>{"use strict";var e={424:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTimer=void 0,t.createTimer=e=>{const t=(new Date).getTime();let r=!1;return{timeIsUp:()=>{if(r)return!0;const a=(new Date).getTime()-t;return r=a>e,r}}}},944:(e,t,r)=>{t.O5=t.TA=void 0;const a=r(424),o=r(819),l=r(859),n=r(832),i=r(292);t.TA=()=>{let e,t=0;const r=(t,r)=>{if(!e)return;const a=Math.floor(t),o=Math.floor(r),{outputStats:l}=e;for(let e=a;e<o;e++)l[e]=0};let i,s,c=0,u=!0;const f=()=>{(()=>{if(!e||!s||u)return;const{draw:t,count:r,spectrometer:o,outputs:l,outputStats:n}=e,{timeIsUp:i}=(0,a.createTimer)(10);let f=c,p=!1;for(;f<r&&!i();)2!==n[f]&&(p=!0,o.byteFrequency(s[f],l[f],{}),n[f]+=1),f++;p&&t(),c=f%r})(),setTimeout(f,16)};return f(),{setup:t=>{const{windowSize:r,count:a}=t,i=r/2,s=(0,o.createFftRadix4)(r),c=(0,l.createSharedRealArray)("uint8",a*i),u=(0,l.createRealArray)("uint8",a*i),f=(0,n.viewRealArrays)("uint8",u.realRaw,{offset:0,step:i,length:i,count:a}),p=Array(a).fill(0);return e={windowSize:r,count:a,raw:u,spectrometer:s,outputs:f,outputStats:p,draw:()=>c.real.set(u.real)},c.realRaw},start:()=>{u=!1},stop:()=>{u=!0},emitBufferEvent:a=>{if(!e)return;const{count:o}=e,c=(e,t)=>o*(e/t);if("newBuffer"===a.type&&(a=>{if(!e)return;const{windowSize:o,count:c}=e;i=(0,l.viewRealArray)("float32",a);const u=(i.real.length-o)/(c-1);s=(0,n.viewRealArrays)(i.type,i.realRaw,{offset:0,step:u,length:o,count:c}),r(0,c),t=0})(a.buffer),"invalidate"===a.type){if(!i)return;const e=c(a.from,i.real.length),t=c(a.to,i.real.length);r(e,t)}if("shift"===a.type){if(!i)return;(r=>{if(!e)return;const{raw:a,windowSize:o,outputStats:l,count:n}=e,i=o/2;t+=r;let s=Math.floor(t);if(s<0&&(s+=1),0!==s)if(t-=s,s<0){s*=-1,a.real.copyWithin(0,i*s,i*n);for(let e=0;e<n-s;e++)l[e]=l[e+s];for(let e=n-s;e<n;e++)l[e]=0}else{a.real.copyWithin(i*s,0,i*(n-s));for(let e=n-1;e>=s;e--)l[e]=l[e-s];for(let e=s-1;e>=0;e--)l[e]=0}})(c(a.offset,i.real.length))}}}},t.O5=e=>{(0,i.runPromiseWorker)(e,t.TA)}},919:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapAmplitudeToDecibel=void 0,t.mapAmplitudeToDecibel=(e,t)=>{const{min:r=-125,max:a=0}=t||{},o=1/(a-r);for(let t=0;t<e.real.length;t++){const r=e.real[t],l=(20*Math.log10(r)+a)*o,n=Math.max(0,Math.min(1,l+1));e.real[t]=n}}},819:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createFftRadix4=t.createFftRadix4Base=void 0;const a=r(736),o=r(343),l=e=>{const{input:t,output:r,outOff:a,off:o,step:l}=e,n=t.real[o],i=t.imag[o],s=t.real[o+l],c=t.imag[o+l],u=n+s,f=i+c,p=n-s,d=i-c;r.real[a]=u,r.imag[a]=f,r.real[a+1]=p,r.imag[a+1]=d},n=e=>{const{input:t,output:r,inv:a,outOff:o,off:l,step:n}=e,i=a?-1:1,s=2*n,c=3*n,u=t.real[l],f=t.imag[l],p=t.real[l+n],d=t.imag[l+n],y=t.real[l+s],w=t.imag[l+s],m=t.real[l+c],M=t.imag[l+c],h=u+y,R=f+w,v=u-y,A=f-w,g=p+m,b=d+M,_=i*(p-m),F=i*(d-M),x=h+g,P=R+b,T=v+F,W=A-_,E=h-g,I=R-b,O=v-F,S=A+_;r.real[o]=x,r.imag[o]=P,r.real[o+1]=T,r.imag[o+1]=W,r.real[o+2]=E,r.imag[o+2]=I,r.real[o+3]=O,r.imag[o+3]=S},i=e=>{const{input:t,output:r,inv:a,windowSize:o,width:i,reverseTable:s,table:c}=e;let u,f,p=1<<i,d=o>>>i;if(2===d)for(u=0,f=0;u<o;u+=2,f++){const e=s[f];l({input:t,output:r,outOff:u,off:e,step:p})}else for(u=0,f=0;u<o;u+=4,f++){const e=s[f];n({input:t,output:r,inv:a,outOff:u,off:e,step:p})}const y=a?-1:1;for(p>>=1;p>=2;p>>=2){d=o/p<<1;const e=d>>>2;for(u=0;u<o;u+=d){const t=u+e;for(let a=u,o=0;a<t;a++,o+=p){const t=a,l=t+e,n=l+e,i=n+e,s=r.real[t],u=r.imag[t],f=r.real[l],p=r.imag[l],d=r.real[n],w=r.imag[n],m=r.real[i],M=r.imag[i],h=s,R=u,v=c.real[o],A=y*c.real[o+1],g=f*v-p*A,b=f*A+p*v,_=c.real[2*o],F=y*c.real[2*o+1],x=d*_-w*F,P=d*F+w*_,T=c.real[3*o],W=y*c.real[3*o+1],E=m*T-M*W,I=m*W+M*T,O=h+x,S=R+P,B=h-x,j=R-P,z=g+E,C=b+I,L=y*(g-E),U=y*(b-I),k=O+z,q=S+C,D=O-z,N=S-C,Y=B+U,H=j-L,G=B-U,J=j+L;r.real[t]=k,r.imag[t]=q,r.real[l]=Y,r.imag[l]=H,r.real[n]=D,r.imag[n]=N,r.real[i]=G,r.imag[i]=J}}}};t.createFftRadix4Base=e=>{if(e<=1||0!=(e&e-1))throw new Error("FFT size must be a power of two and bigger than 1");const t=((e,t)=>{const r=(0,a.createRealIndexable)("list",2*t);for(let e=0;e<r.real.length;e+=2){const a=Math.PI*e/t;r.real[e]=Math.cos(a),r.real[e+1]=-Math.sin(a)}return r})(0,e),r=(e=>{let t=0;for(let r=1;e>r;r<<=1)t++;return(t%2==0?t-1:t)-1})(e),o=(e=>{const t=new Uint32Array(1<<e);for(let r=0;r<t.length;r++){t[r]=0;for(let a=0;a<e+1;a+=2){const o=e-a-1;t[r]|=(r>>>a&3)<<o}t[r]/=2}return t})(r);return{forward:(a,l)=>{i({input:a,output:l,inv:!1,windowSize:e,width:r,reverseTable:o,table:t})},inverse:(a,l)=>{i({input:a,output:l,inv:!0,windowSize:e,width:r,reverseTable:o,table:t});for(let t=0;t<e;t++)l.real[t]/=e,l.imag[t]/=e}}},t.createFftRadix4=e=>{const r=(0,t.createFftRadix4Base)(e);return(0,o.createSpectrometer)(e,r)}},343:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSpectrometer=void 0;const a=r(192),o=r(927),l=r(736),n=r(919),i=r(119);t.createSpectrometer=(e,t)=>{const{forward:r,inverse:s}=t,c=(0,a.createComplexIndexable)("float64",e),u=(0,l.createRealIndexable)("float64",e/2),f=(0,a.createComplexIndexable)("list",e),p=(0,i.gaussWindowFilter)("float64",e),d={forward:r,inverse:s,frequency:(t,a,l)=>{const{convert:i=n.mapAmplitudeToDecibel}=l;for(let r=0;r<e;r++)c.real[r]=t.real[r]*p.real[r],c.imag[r]=0;r(c,f),(0,o.normComplexIndexable)(f,a,1/e),i(a)},byteFrequency:(t,r,a)=>{d.frequency(t,u,a);for(let t=0;t<e/2;t++)r.real[t]=Math.round(255*u.real[t])}};return d}},119:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.triangularWindowFilter=t.rectangularWindowFilter=t.lanczozWindowFilter=t.hannWindowFilter=t.hammingWindowFilter=t.gaussWindowFilter=t.cosineWindowFilter=t.blackmanWindowFilter=t.bartlettHannWindowFilter=t.bartlettWindowFilter=t.zeroWindowFilter=void 0;const a=r(859);t.zeroWindowFilter=(e,t)=>{const r=(0,a.createRealArray)(e,t);for(let e=0;e<t;e++)r.real[e]=0;return r},t.bartlettWindowFilter=(e,t)=>{const r=(0,a.createRealArray)(e,t),o=t-1;for(let e=0;e<t;e++)r.real[e]=2/o*(o/2-Math.abs(e-o/2));return r},t.bartlettHannWindowFilter=(e,t)=>{const r=(0,a.createRealArray)(e,t),o=t-1;for(let e=0;e<t;e++)r.real[e]=2/o*(o/2-Math.abs(e-o/2));return r},t.blackmanWindowFilter=(e,t)=>{const r=(0,a.createRealArray)(e,t),o=t-1;for(let e=0;e<t;e++){const t=2*Math.PI*e/o,a=4*Math.PI*e/o;r.real[e]=.42-.5*Math.cos(t)+.08*Math.cos(a)}return r},t.cosineWindowFilter=(e,t)=>{const r=(0,a.createRealArray)(e,t);for(let e=0;e<t;e++)r.real[e]=Math.cos(Math.PI*e/(t-1)-Math.PI/2);return r},t.gaussWindowFilter=(e,t)=>{const r=(0,a.createRealArray)(e,t);for(let e=0;e<t;e++){const a=(e-(t-1)/2)/(.25*(t-1)/2);r.real[e]=Math.pow(Math.E,-.5*Math.pow(a,2))}return r},t.hammingWindowFilter=(e,t)=>{const r=(0,a.createRealArray)(e,t);for(let e=0;e<t;e++)r.real[e]=.54-.46*Math.cos(2*Math.PI*e/(t-1));return r},t.hannWindowFilter=(e,t)=>{const r=(0,a.createRealArray)(e,t);for(let e=0;e<t;e++)r.real[e]=.5*(1-Math.cos(2*Math.PI*e/(t-1)));return r},t.lanczozWindowFilter=(e,t)=>{const r=(0,a.createRealArray)(e,t),o=t-1;for(let e=0;e<t;e++)r.real[e]=Math.sin(Math.PI*(2*e/o-1))/(Math.PI*(2*e/o-1));return r},t.rectangularWindowFilter=(e,t)=>{const r=(0,a.createRealArray)(e,t);for(let e=0;e<t;e++)r.real[e]=1;return r},t.triangularWindowFilter=(e,t)=>{const r=(0,a.createRealArray)(e,t);for(let e=0;e<t;e++)r.real[e]=2/t*(t/2-Math.abs(e-(t-1)/2));return r}},732:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createComplexArray=void 0;const a=r(962);t.createComplexArray=(e,t)=>{const r=a.realBytesMap[e],o=new ArrayBuffer(r*t),l=a.createRealTypeMap[e](o,0,t),n=new ArrayBuffer(r*t);return{real:l,realRaw:o,imag:a.createRealTypeMap[e](n,0,t),imagRaw:n,type:e}}},192:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createComplexIndexable=void 0;const a=r(732),o=r(284);t.createComplexIndexable=(e,t)=>"list"===e?(0,o.createComplexList)(t):(0,a.createComplexArray)(e,t)},284:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createComplexList=void 0,t.createComplexList=e=>{const t=new Array(e);for(let r=0;r<e;r++)t[r]=0;const r=new Array(e);for(let t=0;t<e;t++)r[t]=0;return{real:t,imag:r,type:"list"}}},927:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.normComplexIndexable=void 0,t.normComplexIndexable=(e,t,r)=>{const a=t.real.length;for(let o=0;o<a;o++){const a=e.real[o],l=e.imag[o];t.real[o]=r*Math.sqrt(a*a+l*l)}}},859:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.viewRealArray=t.createSharedRealArray=t.createRealArray=void 0;const a=r(962);t.createRealArray=(e,t)=>{const r=a.realBytesMap[e],o=new ArrayBuffer(r*t);return{real:a.createRealTypeMap[e](o,0,t),realRaw:o,type:e}},t.createSharedRealArray=(e,t)=>{const r=a.realBytesMap[e],o=new SharedArrayBuffer(r*t);return{real:a.createRealTypeMap[e](o),realRaw:o,type:e}},t.viewRealArray=(e,t,r,o)=>{const l=t,n=a.realBytesMap[e],i=r?r*n:void 0;return{real:a.createRealTypeMap[e](l,i,o),realRaw:l,type:e}}},832:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.viewRealArrays=t.createRealArrays=void 0;const a=r(859),o=r(962);t.createRealArrays=(e,t,r)=>{const{step:l,count:n,length:i}=r,s=o.realBytesMap[e],c=new ArrayBuffer(s*t);let{offset:u}=r;const f=[];for(let t=0;t<n;t++){const t=(0,a.viewRealArray)(e,c,Math.floor(u),i);f.push(t),u+=l}return f},t.viewRealArrays=(e,t,r)=>{const{step:o,count:l,length:n}=r,i=t;let{offset:s}=r;const c=[];for(let t=0;t<l;t++){const t=(0,a.viewRealArray)(e,i,Math.floor(s),n);c.push(t),s+=o}return c}},736:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRealIndexable=void 0;const a=r(859),o=r(215);t.createRealIndexable=(e,t)=>"list"===e?(0,o.createRealList)(t):(0,a.createRealArray)(e,t)},215:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRealList=void 0,t.createRealList=e=>{const t=new Array(e);for(let r=0;r<e;r++)t[r]=0;return{real:t,type:"list"}}},962:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createRealTypeMap=t.realBytesMap=void 0,t.realBytesMap={float32:Float32Array.BYTES_PER_ELEMENT,float64:Float64Array.BYTES_PER_ELEMENT,uint32:Uint32Array.BYTES_PER_ELEMENT,uint8:Uint8Array.BYTES_PER_ELEMENT},t.createRealTypeMap={float32:(...e)=>new Float32Array(...e),float64:(...e)=>new Float64Array(...e),uint32:(...e)=>new Uint32Array(...e),uint8:(...e)=>new Uint8Array(...e)}},292:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runPromiseWorker=void 0,t.runPromiseWorker=(e,t)=>{const r=t=>{e.postMessage(t)},a=t({pushEvent:(e,t)=>{r({id:"",type:e,result:t})}});e.onmessage=e=>{const{id:t,type:o,args:l}=e.data,n=a[o](...l);r({id:t,type:o,result:n})}}}},t={};(0,function r(a){var o=t[a];if(void 0!==o)return o.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,r),l.exports}(944).O5)(self)})();